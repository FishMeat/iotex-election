# Tools
This sub-repo is for tools related to election, staking and voting.

# Bookkeeper
Bookkeeper = Dumper + Processor and handles bookkeeping.

Bookkeeper can handle up to 300 voters.

Attention: 
This Bookkeeper is a REFERENCE IMPLEMENTATION of reward distribution tool provided by IOTEX FOUNDATION. IOTEX FOUNDATION disclaims all responsibility for any damages or losses (including, without limitation, financial loss, damages for loss in business projects, loss of profits or other consequential losses) arising in contract, tort or otherwise from the use of or inability to use the Bookkeeper, or from any action or decision taken as a result of using this Bookkeeper.


## Build
```
go build
```

## Get Voters' Rewards by Delegate Name
Usage: `bookkeeper --bp BP_NAME --epoch EPOCH_NUM (--dist-percentage DIST_PERCENTAGE --reward-address REWARD_ADDRESS|--amount TOTAL_AMOUNT)`

```
./bookkeeper --bp iotexbp --epoch 101 --dist-percentage 77 --reward-address io1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```
```
./bookkeeper --bp iotexbp --epoch 101 --amount 1024
```
warning: votes in different epoches may be different
## Send Out Voters' Rewards
The generated bytecode can be used by `ioctl` to actually send out the voters' rewards, i.e.,
```
ioctl action invoke io1sesxdghz93f4sadhu6a7242m22gphmc2aucz4g <total-amount> -l <gas-limit> -p <gas-price> -s <signer> -b <bytecode>`
```

Note that `io1sesxdghz93f4sadhu6a7242m22gphmc2aucz4g` is the pre-deployed contract for sending IOTX coins to multiple addresses.

# Dumper (Deprecated)
Dumper dumps the information from staking contract (0x87c9dbff0016af23f5b1ab9b8e072124ab729193) and registration contract (0x95724986563028deb58f15c5fac19fa09304f32d) to a local csv file.

# Processor (Deprecated)
Processor processes the csv produced by Dumper and generate another csv that breaks down the votes to each voters for each delegate. See the samples for more information.

# Generate breakdown of votes
```
go run tools/dumper/dumper.go > tools/processor/stats.csv
go run tools/processor/processor.go
```
# How to use the produced information

For example, one BP's breakdown looks like below:
```
>>>blockboost<<<
io1yfyjftv050x3pc6ee33k3eg23ldzm8pn229972    1491626522508296126545702
io1ge3ursda36ept6vqlq3g3kknd92rfuw2ecpehk    7531000000000000000000
io1t09saa20x8n89rn0zjusjnh4pw2lemlhty3lnc    4000000000000000000000000
io1cchxj9ffwm75teycynjmuknffvwdmc5sk94pn5    2000000000000000000000000
io1cse9e458vyqea0vdmlz0kzed8mv2xplme5qmes    860828544270782813896403
```
which translates to
```
io1yfyjftv050x3pc6ee33k3eg23ldzm8pn229972    17.84%
io1ge3ursda36ept6vqlq3g3kknd92rfuw2ecpehk    0.09%
io1t09saa20x8n89rn0zjusjnh4pw2lemlhty3lnc    47.84%
io1cchxj9ffwm75teycynjmuknffvwdmc5sk94pn5    23.92%
io1cse9e458vyqea0vdmlz0kzed8mv2xplme5qmes    10.29%
```

If this bp blockboost earned 125 IOTX in this epoch, and would distribute 80% (of 125 IOTX) to his/her voters. He/she will send 17.84, 0.09, 47.84, 23.92 and 10.29 IOTX to the five io addresses respectively.
